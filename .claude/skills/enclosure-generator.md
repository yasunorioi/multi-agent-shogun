# IoTノード筐体ジェネレーター

IoTノード用の3Dプリント筐体をOpenSCADソースコードで自動生成するスキル。
パラメトリック設計により、ボード寸法・センサー・ファンサイズに応じてカスタマイズ可能。

## 使用方法

```
/enclosure-generator <プリセット名 or カスタム> [オプション]
```

### 基本例

```bash
# プリセットを使用
/enclosure-generator indoor-climate-node

# カスタム寸法を指定
/enclosure-generator custom --board-size 51x21x12 --sensor-size 32x24x8 --fan 30mm

# 設計書も同時生成
/enclosure-generator indoor-climate-node --with-docs
```

## パラメータ

| パラメータ | 説明 | 例 | デフォルト |
|-----------|------|-----|----------|
| プリセット名 | 定義済みの筐体タイプ | `indoor-climate-node` | - |
| `--board-size` | ボード寸法 (W x D x H mm) | `51x21x12` | - |
| `--sensor-size` | センサー寸法 (W x D x H mm) | `32x24x8` | `0x0x0` |
| `--fan` | ファンサイズ | `25mm`, `30mm`, `40mm`, `none` | `30mm` |
| `--mounting` | 固定方式 | `m3-insert`, `m3-standoff`, `snap-fit` | `m3-insert` |
| `--box-size` | 筐体外形 (W x D x H mm) | `80x60x40` | 自動計算 |
| `--wall` | 壁厚 (mm) | `2.5` | `2.5` |
| `--ports` | ポート指定（カンマ区切り） | `rj45,usb-c,led-window` | `rj45` |
| `--output-dir` | 出力ディレクトリ | `./cad/enclosure/` | `./` |
| `--with-docs` | 設計書も同時生成 | - | false |
| `--lang` | 言語 | `ja`, `en` | `ja` |

## プリセット一覧

### 室内環境ノード

| プリセットID | 対象ボード | センサー | ファン |
|-------------|-----------|---------|--------|
| `indoor-climate-node` | W5500-EVB-Pico-PoE | ENV III/IV | 30mm |
| `indoor-climate-compact` | Pico 2 W | ENV III/IV | 25mm |
| `co2-monitor` | W5500-EVB-Pico-PoE | SCD41 | 30mm |

### 屋外環境ノード

| プリセットID | 対象ボード | センサー | ファン |
|-------------|-----------|---------|--------|
| `outdoor-weather` | W5500-EVB-Pico-PoE | BH1750 + ENV III | none |
| `rain-sensor-node` | W5500-EVB-Pico-PoE | SEN0575 | none |

### リレーノード

| プリセットID | 対象ボード | リレー | ファン |
|-------------|-----------|--------|--------|
| `relay-4ch` | Pico 2 W | 4ch | none |
| `relay-8ch` | W5500-EVB-Pico-PoE | 8ch Waveshare | 30mm |

## 固定方式

| 方式ID | 説明 | 工具 | 耐久性 |
|--------|------|------|--------|
| `m3-insert` | M3インサートナット（熱圧入） | ハンダゴテ | 高 |
| `m3-standoff` | M3スタンドオフ（ネジ止め） | ドライバー | 高 |
| `snap-fit` | スナップフィット（工具不要） | なし | 中 |

## ポート種類

| ポートID | 開口寸法 (W x H mm) | 用途 |
|----------|-------------------|------|
| `rj45` | 16 x 14 | イーサネット（PoE） |
| `usb-c` | 9 x 3.5 | USB-C電源/データ |
| `usb-micro` | 8 x 3 | microUSB電源/データ |
| `led-window` | Φ5 | LEDステータス表示 |
| `button` | Φ7 | 押しボタン |
| `grove` | 10 x 8 | Groveコネクタ |
| `cable-gland-pg7` | Φ12.5 | PG7ケーブルグランド |
| `vent-slots` | 2 x 10 x 6個 | 通気スロット |

## 出力ファイル

### OpenSCADソースコード

```
{output_dir}/{preset_name}.scad
```

**ファイル構成**:

```
/*
 * {プリセット名} Enclosure
 * Generated by enclosure-generator skill
 * Date: YYYY-MM-DD
 */

// ============================================================================
// Parameters
// ============================================================================
box_width = 80;
box_depth = 60;
box_height = 40;
wall_thickness = 2.5;
...

// ============================================================================
// Main Assembly
// ============================================================================
render_box = true;
render_lid = true;
...

// ============================================================================
// Modules
// ============================================================================
module box_body() { ... }
module lid() { ... }
module fan_mounting_holes() { ... }
module board_mounting_posts() { ... }
...
```

### 設計書（--with-docs指定時）

```
{output_dir}/{preset_name}_DESIGN.md
```

**含まれる内容**:
- 概要・主な特徴
- 設計要件（収納物、筐体寸法、換気システム）
- 寸法図（ASCII）
- 部品リスト（BOM）
- 3Dプリント設定
- OpenSCADエクスポート手順
- 組立手順（インサートナット圧入、基板取付、配線）
- トラブルシューティング
- カスタマイズ方法

## OpenSCADテンプレート

### 基本構造

```openscad
// ============================================================================
// IoT Node Enclosure Template
// ============================================================================

// --- Box Dimensions ---
box_width = {{BOX_WIDTH}};          // mm (X-axis)
box_depth = {{BOX_DEPTH}};          // mm (Y-axis)
box_height = {{BOX_HEIGHT}};        // mm (Z-axis, excluding lid)
wall_thickness = {{WALL_THICKNESS}};

lid_height = 3;
lid_lip_depth = 2;

// --- Board Dimensions ---
board_width = {{BOARD_WIDTH}};
board_depth = {{BOARD_DEPTH}};
board_height = {{BOARD_HEIGHT}};
board_standoff_height = 5;

// --- Sensor Dimensions ---
sensor_width = {{SENSOR_WIDTH}};
sensor_depth = {{SENSOR_DEPTH}};
sensor_height = {{SENSOR_HEIGHT}};
sensor_opening_width = {{SENSOR_WIDTH}} + 3;
sensor_opening_depth = {{SENSOR_DEPTH}} + 3;

// --- Fan Dimensions ---
fan_size = {{FAN_SIZE}};  // 0 = no fan
fan_mounting_hole_spacing = {{FAN_HOLE_SPACING}};
fan_mounting_hole_dia = 3.2;

// --- Mounting Hardware ---
m3_insert_outer_dia = 4.2;
m3_insert_depth = 4;
m3_screw_head_dia = 6;
m3_screw_head_depth = 3;

// --- Ports ---
{{#PORTS}}
{{PORT_NAME}}_width = {{PORT_WIDTH}};
{{PORT_NAME}}_height = {{PORT_HEIGHT}};
{{/PORTS}}

// --- Rendering ---
$fn = 50;

// ============================================================================
// Main Assembly
// ============================================================================

render_box = true;
render_lid = true;
render_both = false;
assembly_mode = false;

if (assembly_mode) {
    box_body();
    translate([0, 0, box_height - lid_lip_depth])
        lid();
} else if (render_both) {
    box_body();
    translate([box_width + 10, 0, 0])
        lid();
} else {
    if (render_box) box_body();
    if (render_lid) lid();
}

// ============================================================================
// Modules
// ============================================================================

module box_body() {
    difference() {
        // Outer shell
        cube([box_width, box_depth, box_height]);

        // Hollow interior
        translate([wall_thickness, wall_thickness, wall_thickness])
            cube([
                box_width - 2 * wall_thickness,
                box_depth - 2 * wall_thickness,
                box_height
            ]);

        // Lid lip cutout
        translate([wall_thickness - lid_lip_depth,
                   wall_thickness - lid_lip_depth,
                   box_height - lid_lip_depth])
            cube([
                box_width - 2 * (wall_thickness - lid_lip_depth),
                box_depth - 2 * (wall_thickness - lid_lip_depth),
                lid_lip_depth + 1
            ]);

        // Sensor ventilation opening (if sensor exists)
        if (sensor_width > 0) {
            translate([
                box_width / 2 - sensor_opening_width / 2,
                wall_thickness - 0.1,
                box_height - wall_thickness - 5
            ])
                cube([sensor_opening_width, sensor_opening_depth + 0.1, 10]);
        }

        // Fan mounting (if fan exists)
        if (fan_size > 0) {
            translate([box_width, box_depth / 2, box_height / 2])
                rotate([0, 90, 0])
                fan_mounting_holes();
        }

        // Port cutouts
        {{#PORTS}}
        port_{{PORT_NAME}}();
        {{/PORTS}}
    }

    // Board mounting posts
    board_mounting_posts();

    // Lid screw posts
    lid_screw_posts();
}

module lid() {
    difference() {
        union() {
            cube([box_width, box_depth, lid_height]);
            translate([wall_thickness - lid_lip_depth,
                       wall_thickness - lid_lip_depth,
                       -lid_lip_depth])
                cube([
                    box_width - 2 * (wall_thickness - lid_lip_depth),
                    box_depth - 2 * (wall_thickness - lid_lip_depth),
                    lid_lip_depth
                ]);
        }
        lid_screw_holes();

        // Ventilation slots
        for (i = [0:5]) {
            translate([
                box_width / 2 - 25 + i * 10,
                box_depth / 2 - 1,
                -0.1
            ])
                cube([2, 2, lid_height + 0.2]);
        }
    }
}

module fan_mounting_holes() {
    // Fan opening
    hull() {
        for (x = [-fan_size/2 + 2, fan_size/2 - 2]) {
            for (y = [-fan_size/2 + 2, fan_size/2 - 2]) {
                translate([x, y, -wall_thickness - 0.1])
                    cylinder(h = wall_thickness + 0.2, d = 4);
            }
        }
    }
    // Mounting holes
    for (x = [-fan_mounting_hole_spacing/2, fan_mounting_hole_spacing/2]) {
        for (y = [-fan_mounting_hole_spacing/2, fan_mounting_hole_spacing/2]) {
            translate([x, y, -wall_thickness - 0.1])
                cylinder(h = wall_thickness + 0.2, d = fan_mounting_hole_dia);
        }
    }
}

module board_mounting_posts() {
    post_positions = [
        [wall_thickness + 5, wall_thickness + 5],
        [wall_thickness + board_width - 5, wall_thickness + 5],
        [wall_thickness + 5, wall_thickness + board_depth - 5],
        [wall_thickness + board_width - 5, wall_thickness + board_depth - 5]
    ];
    for (pos = post_positions) {
        translate([pos[0], pos[1], wall_thickness])
            cylinder(h = board_standoff_height, d = 6);
    }
}

module lid_screw_posts() {
    post_positions = [
        [wall_thickness + 5, wall_thickness + 5],
        [box_width - wall_thickness - 5, wall_thickness + 5],
        [wall_thickness + 5, box_depth - wall_thickness - 5],
        [box_width - wall_thickness - 5, box_depth - wall_thickness - 5]
    ];
    for (pos = post_positions) {
        difference() {
            translate([pos[0], pos[1], wall_thickness])
                cylinder(h = box_height - wall_thickness - lid_lip_depth, d = 8);
            translate([pos[0], pos[1], box_height - m3_insert_depth])
                cylinder(h = m3_insert_depth + 0.1, d = m3_insert_outer_dia);
        }
    }
}

module lid_screw_holes() {
    hole_positions = [
        [wall_thickness + 5, wall_thickness + 5],
        [box_width - wall_thickness - 5, wall_thickness + 5],
        [wall_thickness + 5, box_depth - wall_thickness - 5],
        [box_width - wall_thickness - 5, box_depth - wall_thickness - 5]
    ];
    for (pos = hole_positions) {
        translate([pos[0], pos[1], -0.1]) {
            cylinder(h = lid_height + 0.2, d = 3.2);
            translate([0, 0, lid_height - m3_screw_head_depth])
                cylinder(h = m3_screw_head_depth + 0.1, d = m3_screw_head_dia);
        }
    }
}

// --- Port Modules ---

module port_rj45() {
    translate([
        box_width / 2 - rj45_width / 2,
        -0.1,
        wall_thickness + 5
    ])
        cube([rj45_width, wall_thickness + 0.2, rj45_height]);
}

module port_usb_c() {
    translate([
        box_width / 2 - usb_c_width / 2,
        -0.1,
        wall_thickness + 5
    ])
        cube([usb_c_width, wall_thickness + 0.2, usb_c_height]);
}

module port_led_window() {
    translate([box_width / 2, box_depth, wall_thickness + 10])
        rotate([90, 0, 0])
        cylinder(h = wall_thickness + 0.2, d = 5);
}
```

## ファンサイズ寸法表

| サイズ | 外形 (mm) | 取付穴間隔 (mm) | 厚さ (mm) |
|--------|----------|----------------|----------|
| 25mm | 25 x 25 | 20 | 7-10 |
| 30mm | 30 x 30 | 24 | 10 |
| 40mm | 40 x 40 | 32 | 10-20 |

## 3Dプリント推奨設定

### スライサー設定

| 項目 | 推奨値 | 備考 |
|------|--------|------|
| フィラメント | PLA / PETG | PETGは耐熱性向上 |
| レイヤー高さ | 0.2mm | 標準 |
| 壁の厚さ | 3層（1.2mm） | 強度確保 |
| 上下面レイヤー | 5層 | - |
| インフィル | 20% | Gyroid or Grid |
| サポート | **不要** | サポートフリー設計 |
| ブリム | 推奨 | ベッド密着性向上 |
| 印刷速度 | 50 mm/s | 品質優先 |

### プリント方向

| パーツ | 向き |
|--------|------|
| ボックス本体 | 開口部を上に |
| フタ | 平面を下に |

### フィラメント別温度設定

| フィラメント | ノズル温度 | ベッド温度 |
|-------------|-----------|-----------|
| PLA | 200-210℃ | 60℃ |
| PETG | 230-240℃ | 80℃ |
| ABS | 240-250℃ | 100℃ |

## 使用例

### 例1: 内気象ノードの筐体生成

```bash
/enclosure-generator indoor-climate-node --output-dir ./cad/enclosure/ --with-docs
```

**生成ファイル**:
- `./cad/enclosure/indoor_climate_node.scad`
- `./cad/enclosure/indoor_climate_node_DESIGN.md`

### 例2: カスタム筐体（ESP32 + DHT22）

```bash
/enclosure-generator custom \
  --board-size 54x25x10 \
  --sensor-size 15x12x5 \
  --fan none \
  --ports usb-micro,vent-slots \
  --mounting snap-fit \
  --output-dir ./cad/
```

### 例3: リレーノード（8ch）

```bash
/enclosure-generator relay-8ch --with-docs
```

### 例4: 屋外用（防水対応）

```bash
/enclosure-generator outdoor-weather \
  --ports cable-gland-pg7 \
  --wall 3.0 \
  --with-docs
```

## 組立手順テンプレート

### 1. インサートナット圧入

1. **ハンダゴテの準備**
   - 温度: 200-220℃（PLA）/ 230-250℃（PETG）

2. **インサートナットの配置**
   - ボックス本体の4隅のポスト上面の穴にナットを置く

3. **圧入**
   - ハンダゴテの先端でナットを押し込む
   - 垂直を保ち、傾かないように注意
   - 2-3秒キープして完全に押し込む

4. **冷却**
   - 1分程度の自然冷却を待つ

5. **確認**
   - M3ネジがスムーズに入ることを確認

### 2. 基板の取付

1. スタンドオフ上に基板を配置
2. センサーをGroveケーブルで接続
3. ファンを取り付け（風向き: 外→内）
4. ケーブル配線

### 3. フタの取付

1. 動作確認
2. フタを被せる（リップ部分を溝に合わせる）
3. M3ネジで4箇所を対角線上に締める

## 部品リスト（参考）

### 共通部品

| 部品名 | 数量 | 仕様 | 参考価格 |
|--------|------|------|---------|
| M3インサートナット | 4 | 外径4.2mm、長さ4mm | ¥100/10個 |
| M3ネジ | 4 | 長さ10mm、皿ネジ推奨 | ¥100/20個 |

### ファン（オプション）

| サイズ | 電圧 | 参考価格 |
|--------|------|---------|
| 25mm | 5V | ¥200～ |
| 30mm | 5V/12V | ¥300～ |
| 40mm | 5V/12V | ¥400～ |

### 工具

| 工具名 | 用途 |
|--------|------|
| ハンダゴテ | インサートナット圧入 |
| ドライバー | M3ネジ締め |
| カッター/ヤスリ | バリ取り |

## トラブルシューティング

### 3Dプリント

| 問題 | 原因 | 対処方法 |
|------|------|---------|
| 1層目が剥がれる | ベッド密着不足 | ブリムを有効化 |
| インサートナット穴が小さい | 収縮 | `m3_insert_outer_dia`を0.2mm増やす |
| 反り（ワーピング） | 冷却不均一 | エンクロージャー使用 |

### 組立

| 問題 | 原因 | 対処方法 |
|------|------|---------|
| インサートナットが傾く | 圧入角度ミス | ハンダゴテを垂直に保つ |
| フタがきつい | プリント精度 | リップ部分をヤスリで調整 |

## 参考資料

### OpenSCAD

- [OpenSCAD公式サイト](https://openscad.org/)
- [OpenSCADチュートリアル](https://en.wikibooks.org/wiki/OpenSCAD_User_Manual)

### 3Dプリント

- [Heat-Set Insert Installation Guide](https://hackaday.com/2019/02/28/threading-3d-printed-parts-how-to-use-heat-set-inserts/)
- [3D Printing Support Guide (All3DP)](https://all3dp.com/1/3d-printing-support-structures/)

### 関連スキル

- `pinout-diagram-generator` - ピン配置図生成
- `circuitpython-project-initializer` - CircuitPythonプロジェクト初期化
- `agri-iot-board-design-template` - 農業IoTボード設計

---

**Skill Version**: 1.0.0
**Last Updated**: 2026-02-06
