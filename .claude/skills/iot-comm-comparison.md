# iot-comm-comparison

IoTデバイス通信方式の比較レポートを自動生成するスキル。

## 概要

MQTT、HTTP、WebSocket、TCP/UDP等のIoT通信プロトコルを多角的に比較し、プロジェクト要件に最適な方式を選定するためのレポートを生成する。

## 使用方法

```
/iot-comm-comparison [オプション]
```

### 入力パラメータ

| パラメータ | 必須 | 説明 | 例 |
|-----------|------|------|-----|
| `--protocols` | No | 比較対象プロトコル（カンマ区切り） | `--protocols mqtt,http,websocket` |
| `--usecase` | No | ユースケース指定 | `--usecase "農業IoT"` |
| `--criteria` | No | 重視する評価軸 | `--criteria "latency,power"` |
| `--output` | No | 出力ファイルパス | `--output comparison.md` |

## 比較対象プロトコル

| プロトコル | 説明 |
|-----------|------|
| MQTT | 軽量Pub/Sub、IoT標準 |
| HTTP/REST | 汎用、ステートレス |
| WebSocket | 双方向リアルタイム |
| TCP (Raw) | 低レベル、高効率 |
| UDP | 超低遅延、ロス許容 |
| CoAP | 制約デバイス向けREST |
| AMQP | エンタープライズMQ |

## 出力形式

### Markdown形式の比較レポート

```markdown
# IoT通信方式比較レポート

## 1. 総合比較表

| 項目 | MQTT | HTTP | WebSocket | TCP | UDP |
|------|------|------|-----------|-----|-----|
| 遅延 | 低 | 中 | 低 | 最低 | 最低 |
| 帯域効率 | 高 | 低 | 中 | 高 | 高 |
| 実装難易度 | 低 | 最低 | 中 | 高 | 高 |
| 双方向通信 | Yes | No | Yes | Yes | Yes |
| 信頼性 | 高 | 高 | 中 | 高 | 低 |

## 2. 詳細評価

### 遅延（Latency）
...

### 帯域効率
...
```

## サンプル出力

```
$ /iot-comm-comparison --usecase "農業環境制御" --protocols mqtt,http,websocket,uecs

# IoT通信方式比較レポート
## ユースケース: 農業環境制御

生成日時: 2026-02-04 15:15:00

---

## 1. 総合比較表

| 評価項目 | MQTT | HTTP/REST | WebSocket | UECS(UDP) |
|----------|------|-----------|-----------|-----------|
| 遅延 | ★★★★☆ | ★★★☆☆ | ★★★★☆ | ★★★★★ |
| 帯域効率 | ★★★★★ | ★★☆☆☆ | ★★★☆☆ | ★★★★★ |
| 信頼性 | ★★★★★ | ★★★★★ | ★★★☆☆ | ★★★☆☆ |
| 実装難易度 | ★★★★☆ | ★★★★★ | ★★★☆☆ | ★★☆☆☆ |
| スケーラビリティ | ★★★★★ | ★★★★☆ | ★★★☆☆ | ★★☆☆☆ |
| 省電力性 | ★★★★★ | ★★☆☆☆ | ★★☆☆☆ | ★★★★☆ |
| 業界標準度 | ★★★★★ | ★★★★★ | ★★★★☆ | ★★★☆☆ |

**総合スコア**: MQTT (32) > HTTP (27) > WebSocket (24) > UECS (23)

---

## 2. プロトコル別詳細

### MQTT
- **特徴**: Pub/Sub型軽量プロトコル、QoSレベル対応
- **ポート**: 1883 (TCP), 8883 (TLS)
- **ヘッダサイズ**: 2バイト〜
- **農業IoT適性**: ★★★★★
  - センサーデータ収集に最適
  - Retain機能で最新値保持
  - Will機能でデバイス死活監視
- **推奨ブローカー**: Mosquitto, EMQX, HiveMQ

### HTTP/REST
- **特徴**: ステートレス、汎用性高い
- **ポート**: 80 (HTTP), 443 (HTTPS)
- **ヘッダサイズ**: 200〜800バイト
- **農業IoT適性**: ★★★☆☆
  - 設定変更・マスタ同期に適
  - 頻繁なポーリングは非効率
  - 既存インフラ活用可能
- **推奨**: RESTful API + Webhookの組み合わせ

### WebSocket
- **特徴**: 双方向リアルタイム、HTTP互換
- **ポート**: 80/443 (HTTP Upgrade)
- **ヘッダサイズ**: 2〜14バイト（フレーム）
- **農業IoT適性**: ★★★☆☆
  - ダッシュボード表示に最適
  - モバイルアプリ連携
  - 常時接続でリソース消費
- **推奨**: Socket.IO, ws

### UECS (UDP)
- **特徴**: 植物工場標準、マルチキャスト対応
- **ポート**: 16520 (UDP)
- **パケットサイズ**: 128バイト固定
- **農業IoT適性**: ★★★★★（国内温室）
  - 国内温室制御の業界標準
  - マルチキャストで効率的
  - 再送制御なし（要アプリ層対応）
- **注意**: 国際標準ではない

---

## 3. ユースケース別推奨

### センサーデータ収集（1分間隔）
**推奨**: MQTT (QoS 1)
- 理由: 軽量、確実な配信、Retain対応

### リアルタイム制御（100ms以下）
**推奨**: UECS (UDP) または TCP (Raw)
- 理由: 最小遅延、オーバーヘッド最小

### ダッシュボード表示
**推奨**: WebSocket
- 理由: 双方向リアルタイム、ブラウザ対応

### 設定・マスタ同期
**推奨**: HTTP/REST
- 理由: 既存ツール活用、キャッシュ対応

### 複合システム（推奨構成）
```
センサー → [MQTT] → ブローカー → [WebSocket] → ダッシュボード
                  ↓
            [HTTP/REST] → 設定API
                  ↓
制御器 ← [UECS/UDP] ← コントローラ
```

---

## 4. 実装参考

### Node-RED対応ノード
| プロトコル | ノード | インストール |
|-----------|--------|-------------|
| MQTT | mqtt in/out | 標準搭載 |
| HTTP | http request | 標準搭載 |
| WebSocket | websocket in/out | 標準搭載 |
| UDP | udp in/out | 標準搭載 |
| CoAP | node-red-contrib-coap | npm install |

### 通信量目安（1000デバイス、1分間隔）
| プロトコル | 1時間あたり | 備考 |
|-----------|------------|------|
| MQTT | 約 6 MB | ヘッダ最小 |
| HTTP | 約 48 MB | ヘッダ大 |
| WebSocket | 約 7 MB | 初期接続後軽量 |
| UDP | 約 8 MB | 固定長 |

---

## 5. 結論

**農業環境制御システムの推奨構成**:

1. **センサー収集**: MQTT（Mosquitto）
2. **制御指令**: UECS（既存互換）またはMQTT
3. **管理UI**: WebSocket（リアルタイム表示）
4. **外部連携**: HTTP/REST（API公開）

この構成により、低遅延・高信頼性・拡張性を両立できる。
```

## 用途

- **システム設計**: 通信方式の選定根拠作成
- **技術選定**: プロジェクト要件に基づく比較
- **提案書作成**: 顧客向け技術説明資料
- **教育**: IoT通信の概要把握

## 評価軸カスタマイズ

`--criteria` で以下の評価軸を重み付け可能:

| 軸 | 説明 |
|---|------|
| latency | 遅延（リアルタイム性） |
| bandwidth | 帯域効率 |
| reliability | 信頼性・到達保証 |
| power | 省電力性 |
| security | セキュリティ |
| scalability | スケーラビリティ |
| implementation | 実装難易度 |
