# IoTシステム仕様書テンプレート生成スキル

IoTプロジェクトのシステム仕様書テンプレートを自動生成する。
アーキテクチャ図、通信仕様、HW/SW構成、API設計等を定型化。

---

## 1. 概要

### 1.1 目的

IoTシステム構築時に必要となる仕様書の雛形を自動生成し、設計工数を削減する。

### 1.2 対応ドメイン

| ドメイン | 説明 | 特徴的な機能 |
|---------|------|-------------|
| 農業（agriculture） | 温室、施設園芸 | 日出/日入連動、飽差計算、灌水制御 |
| 工場（factory） | FA、生産管理 | OEE、予知保全、品質管理 |
| ビル管理（bems） | BEMS、空調制御 | 省エネ、快適性、デマンド制御 |
| スマートホーム（home） | 家庭用IoT | セキュリティ、照明、空調 |

### 1.3 出力内容

10セクション構成のMarkdown仕様書:
1. システム概要
2. 設計原則
3. アーキテクチャ
4. ハードウェア構成
5. ソフトウェア構成
6. 通信仕様
7. API層設計
8. ダッシュボード設計
9. ドメイン特有機能
10. 今後の課題

---

## 2. 使用方法

### 2.1 入力パラメータ

```yaml
# プロジェクト基本情報
project:
  name: "OpenGreenhouse"              # プロジェクト名
  version: "1.0.0"                    # バージョン
  purpose: "施設園芸向け環境制御"      # 目的
  domain: "agriculture"               # ドメイン（agriculture/factory/bems/home）

# 規模
scale:
  target_users:
    - "個人農家"
    - "JA（農協）"
  expected_sites: "1〜100棟"           # 想定サイト数
  devices_per_site: "5〜20台"          # サイト当たりデバイス数

# プラットフォーム
platform:
  gateway: "Raspberry Pi"              # ゲートウェイ
  controller: "Home Assistant"         # 制御プラットフォーム
  protocol: "MQTT"                     # 通信プロトコル
  database: "SQLite"                   # ローカルDB
  cloud: "optional"                    # クラウド連携（optional/required）

# ハードウェア構成
hardware:
  sensors:
    - name: "温湿度センサー"
      model: "SHT41"
      interface: "I2C"
      count: 2
    - name: "CO2センサー"
      model: "SCD41"
      interface: "I2C"
      count: 1
  actuators:
    - name: "電磁弁"
      channels: 4
      voltage: "DC12V"
    - name: "サーキュレータ"
      channels: 2
      voltage: "AC100V"
  controllers:
    - type: "WiFi"
      model: "Pico 2 WH"
      count: 2
    - type: "Ethernet"
      model: "W5500-EVB-Pico-PoE"
      count: 2

# 通信設計
communication:
  mqtt_broker: "Mosquitto"
  topic_prefix: "farm"
  qos:
    sensor: 0
    control: 1
    alert: 1
  intervals:
    temperature: "10s"
    co2: "30s"
    status: "60s"

# 設計原則（カスタマイズ可能）
principles:
  - "制御はローカル自律"
  - "通信断でも動作継続"
  - "OSS・セルフホスト"
  - "セキュア（VPN）"
```

### 2.2 出力形式

Markdownファイル（`SYSTEM_SPEC_v1.md`）

---

## 3. テンプレート構造

### 3.1 セクション1: システム概要

```markdown
## 1. システム概要

### 1.1 システム名
**{{project.name}}**

### 1.2 目的
{{project.purpose}}

### 1.3 対象ユーザーと想定規模

#### 対象ユーザー
{{#each scale.target_users}}
- {{this}}
{{/each}}

#### 想定規模
| 項目 | 値 |
|------|-----|
| 想定サイト数 | {{scale.expected_sites}} |
| サイト当たりデバイス数 | {{scale.devices_per_site}} |

### 1.4 特徴
| 特徴 | 説明 |
|------|------|
{{#each principles}}
| {{@index}}. | {{this}} |
{{/each}}
```

### 3.2 セクション2: 設計原則

```markdown
## 2. 設計原則

### 2.1 原則一覧

| # | 原則 | 説明 |
|---|------|------|
{{#each principles}}
| {{@index}} | **{{this}}** | （詳細を記載） |
{{/each}}

### 2.2 設計の分離原則

| 原則 | 説明 |
|------|------|
| サイト単位は軽量・自律 | 通信断でも制御継続 |
| APIで標準的にデータ公開 | JSON形式で外部連携 |
| 集計は別システム | スケーラビリティ確保 |
```

### 3.3 セクション3: アーキテクチャ

```markdown
## 3. アーキテクチャ

### 3.1 プラットフォーム選定

**採用プラットフォーム: {{platform.controller}}**

| 採用理由 | 詳細 |
|----------|------|
| OSS・セルフホスト | 月額課金なし |
| スマホアプリ | 完成度が高い |
| 拡張性 | Node-RED統合可能 |

### 3.2 全体構成図

[ASCII図をドメインに応じて生成]

### 3.3 3層構成

| 層 | 構成要素 | 役割 |
|----|---------|------|
| **デバイス層** | {{controllers}} | センサー読み取り、アクチュエータ制御 |
| **ローカルGW層** | {{platform.gateway}} | 制御ロジック、データ永続化 |
| **クラウド層** | VPS ({{platform.cloud}}) | 可視化、長期保存 |
```

### 3.4 セクション4: ハードウェア構成

```markdown
## 4. ハードウェア構成

### 4.1 デバイス一覧

| 用途 | ハードウェア | 電源 | 通信 | 数量 |
|------|-------------|------|------|------|
{{#each hardware.controllers}}
| {{type}}制御 | {{model}} | - | {{type}} | {{count}}台 |
{{/each}}

### 4.2 センサー一覧

| センサー | モデル | インターフェース | 数量 |
|----------|--------|-----------------|------|
{{#each hardware.sensors}}
| {{name}} | {{model}} | {{interface}} | {{count}} |
{{/each}}

### 4.3 アクチュエータ一覧

| アクチュエータ | チャンネル数 | 電圧 |
|---------------|-------------|------|
{{#each hardware.actuators}}
| {{name}} | {{channels}}ch | {{voltage}} |
{{/each}}
```

### 3.5 セクション5: ソフトウェア構成

```markdown
## 5. ソフトウェア構成

### 5.1 ローカルGW層（{{platform.gateway}}）

| コンポーネント | 用途 | 備考 |
|---------------|------|------|
| **{{platform.controller}}** | 統合制御 | メインプラットフォーム |
| **{{communication.mqtt_broker}}** | MQTTブローカー | デバイス間通信 |
| **{{platform.database}}** | ローカルDB | 設定・ログ保存 |
| **Node-RED** | フロー制御 | 複雑なロジック |

### 5.2 デバイス層

| コンポーネント | 用途 |
|---------------|------|
| **CircuitPython** | ランタイム |
| **adafruit_minimqtt** | MQTT通信 |
| **センサードライバ** | センサー読み取り |
```

### 3.6 セクション6: 通信仕様

```markdown
## 6. 通信仕様

### 6.1 MQTTトピック設計

{{topic_tree}}

### 6.2 QoS設定

| データ種別 | QoS | 理由 |
|-----------|-----|------|
| センサーデータ | {{communication.qos.sensor}} | 欠損許容 |
| 制御コマンド | {{communication.qos.control}} | 確実配信 |
| アラート | {{communication.qos.alert}} | 確実配信 |

### 6.3 通信頻度

| データ種別 | 送信間隔 |
|-----------|---------|
{{#each communication.intervals}}
| {{@key}} | {{this}} |
{{/each}}
```

### 3.7 セクション7: API層設計

```markdown
## 7. API層設計

### 7.1 エンドポイント

| メソッド | パス | 説明 |
|---------|------|------|
| GET | /api/v1/{{domain}}/{id}/current | 現在値取得 |
| GET | /api/v1/{{domain}}/{id}/history | 履歴取得 |
| POST | /api/v1/{{domain}}/{id}/control | 制御コマンド |

### 7.2 レスポンス例

{{api_response_example}}
```

### 3.8 セクション8: ダッシュボード設計

```markdown
## 8. ダッシュボード設計

### 8.1 規模別UI設計

| 規模 | 推奨技術 |
|------|---------|
| 小規模（1サイト） | Home Assistant |
| 中規模（2〜10サイト） | Grafana |
| 大規模（10+サイト） | ThingsBoard |

### 8.2 必要な機能

| 機能 | 説明 |
|------|------|
| サイトサマリ | 一覧で異常確認 |
| 詳細画面 | 切替で個別確認 |
| アラート表示 | リアルタイム通知 |
```

### 3.9 セクション9: ドメイン特有機能

ドメインに応じたテンプレートを生成:

#### 農業（agriculture）
```markdown
## 9. 農業特有機能

### 9.1 8時間帯タイマー
| 時間帯 | 説明 |
|--------|------|
| 時間帯1 | 深夜 |
| ... | ... |

### 9.2 日出/日入連動
緯度経度から自動計算

### 9.3 飽差計算・アラート
### 9.4 灌水シーケンス制御
### 9.5 積算日射・積算温度
```

#### 工場（factory）
```markdown
## 9. 工場特有機能

### 9.1 OEE（設備総合効率）計算
### 9.2 予知保全アラート
### 9.3 品質管理（SPC）
### 9.4 生産カウンター
### 9.5 エネルギー監視
```

#### ビル管理（bems）
```markdown
## 9. ビル管理特有機能

### 9.1 デマンド制御
### 9.2 空調スケジュール
### 9.3 照明制御
### 9.4 電力監視
### 9.5 快適性指標（PMV/PPD）
```

#### スマートホーム（home）
```markdown
## 9. スマートホーム特有機能

### 9.1 在宅/外出モード
### 9.2 シーン制御
### 9.3 セキュリティ連携
### 9.4 エネルギー監視
### 9.5 音声アシスタント連携
```

### 3.10 セクション10: 今後の課題

```markdown
## 10. 今後の課題

### 10.1 短期課題（Phase 1）
| 課題 | 優先度 |
|------|--------|
| HW動作検証 | 高 |
| 基本フロー作成 | 高 |

### 10.2 中期課題（Phase 2）
| 課題 | 優先度 |
|------|--------|
| UI実装 | 高 |
| 外部連携 | 中 |

### 10.3 長期課題（Phase 3）
| 課題 | 優先度 |
|------|--------|
| スケールアウト | 中 |
| AI予測 | 低 |
```

---

## 4. アーキテクチャ図テンプレート

### 4.1 農業ドメイン（agriculture）

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                         農業IoTシステム アーキテクチャ                        │
└──────────────────────────────────────────────────────────────────────────────┘

                                   インターネット
                                        │
                                   [4G モデム]
                                        │
┌───────────────────────────────────────┼───────────────────────────────────────┐
│                           ハウス内ローカルネットワーク                         │
│                                       │                                       │
│   ┌───────────────────────────────────┴───────────────────────────────────┐   │
│   │                    Raspberry Pi (ローカルGW)                           │   │
│   │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐              │   │
│   │  │{{ctrl}}  │  │ Node-RED │  │{{db}}    │  │Dashboard │              │   │
│   │  │(MQTT)    │  │          │  │          │  │          │              │   │
│   │  └──────────┘  └──────────┘  └──────────┘  └──────────┘              │   │
│   └───────────────────────────────────┬───────────────────────────────────┘   │
│                                       │                                       │
│              ┌────────────────────────┴────────────────────────┐              │
│              │                 MQTT (port 1883)                │              │
│              │                                                 │              │
│      ┌───────┴────────┐                               ┌────────┴───────┐      │
│  ┌───┴───┐        ┌───┴───┐                       ┌───┴───┐        ┌───┴───┐  │
│  │センサー│        │制御   │                       │センサー│        │制御   │  │
│  │ノード1 │        │ノード1│                       │ノード2 │        │ノード2│  │
│  └───┬───┘        └───┬───┘                       └───┬───┘        └───┬───┘  │
│      │                │                               │                │      │
│  [温湿度]          [電磁弁]                        [CO2]           [ファン]   │
│                                                                               │
└───────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 工場ドメイン（factory）

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                         工場IoTシステム アーキテクチャ                        │
└──────────────────────────────────────────────────────────────────────────────┘

                                    社内LAN
                                        │
┌───────────────────────────────────────┼───────────────────────────────────────┐
│                              製造ライン                                       │
│                                       │                                       │
│   ┌───────────────────────────────────┴───────────────────────────────────┐   │
│   │                    Edge Gateway (産業用PC)                             │   │
│   │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐              │   │
│   │  │MQTT      │  │ Node-RED │  │TimeSeries│  │OPC-UA    │              │   │
│   │  │Broker    │  │          │  │DB        │  │Gateway   │              │   │
│   │  └──────────┘  └──────────┘  └──────────┘  └──────────┘              │   │
│   └───────────────────────────────────┬───────────────────────────────────┘   │
│                                       │                                       │
│      ┌────────────────────────────────┼────────────────────────────────┐      │
│      │                                │                                │      │
│  ┌───┴───┐                        ┌───┴───┐                        ┌───┴───┐  │
│  │PLC    │                        │センサー│                        │カウンタ│  │
│  │       │                        │ユニット│                        │       │  │
│  └───┬───┘                        └───┬───┘                        └───┬───┘  │
│      │                                │                                │      │
│  [設備制御]                        [振動/温度]                      [生産数]   │
│                                                                               │
└───────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. MQTTトピックテンプレート

### 5.1 農業（agriculture）

```
farm/
├── sensors/
│   ├── {device_id}/
│   │   ├── temperature       # 温度 (℃)
│   │   ├── humidity          # 湿度 (%)
│   │   ├── co2               # CO2 (ppm)
│   │   ├── soil_moisture     # 土壌水分 (%)
│   │   ├── radiation         # 日射 (W/m²)
│   │   └── status
├── actuators/
│   ├── {device_id}/
│   │   ├── valve/cmd         # バルブ制御
│   │   ├── fan/cmd           # ファン制御
│   │   └── state
├── alerts/
│   ├── high_temp
│   ├── low_humidity
│   └── vpd_warning
└── system/
    ├── heartbeat
    └── config
```

### 5.2 工場（factory）

```
factory/
├── line/{line_id}/
│   ├── machine/{machine_id}/
│   │   ├── status            # 運転/停止/故障
│   │   ├── cycle_time        # サイクルタイム
│   │   ├── vibration         # 振動値
│   │   └── temperature
│   ├── production/
│   │   ├── count             # 生産数
│   │   ├── good              # 良品数
│   │   └── defect            # 不良数
├── alerts/
│   ├── machine_fault
│   ├── quality_warning
│   └── maintenance_due
└── system/
    ├── heartbeat
    └── config
```

### 5.3 ビル管理（bems）

```
building/
├── floor/{floor_id}/
│   ├── zone/{zone_id}/
│   │   ├── temperature
│   │   ├── humidity
│   │   ├── co2
│   │   ├── occupancy         # 在室人数
│   │   └── lighting          # 照度
│   ├── hvac/
│   │   ├── setpoint          # 設定温度
│   │   ├── mode              # 冷房/暖房/送風
│   │   └── status
├── energy/
│   ├── power                  # 電力 (kW)
│   ├── demand                 # デマンド値
│   └── cumulative             # 積算電力量
├── alerts/
│   ├── demand_warning
│   ├── comfort_alert
│   └── equipment_fault
└── system/
    └── heartbeat
```

### 5.4 スマートホーム（home）

```
home/
├── room/{room_id}/
│   ├── temperature
│   ├── humidity
│   ├── motion                 # 人感
│   ├── door                   # 開閉
│   └── light/
│       ├── cmd
│       └── state
├── security/
│   ├── armed                  # 警戒モード
│   ├── alarm                  # アラーム状態
│   └── camera/{camera_id}
├── energy/
│   ├── power
│   └── solar                  # 太陽光発電
├── presence/
│   ├── home                   # 在宅/外出
│   └── occupants              # 在宅者
└── system/
    └── heartbeat
```

---

## 6. サンプル出力（農業IoT用）

以下は入力パラメータを元に生成される仕様書の抜粋:

```markdown
# システム仕様書 v1.0

> **Version**: 1.0.0
> **作成日**: 2026-02-04
> **プロジェクト**: OpenGreenhouse

---

## 1. システム概要

### 1.1 システム名
**OpenGreenhouse**

### 1.2 目的
施設園芸向け環境制御システム。温度、湿度、CO2等の環境データを収集し、
灌水・換気等を自動制御する。

### 1.3 対象ユーザーと想定規模

#### 対象ユーザー
- 個人農家
- JA（農協）

#### 想定規模
| 項目 | 値 |
|------|-----|
| 想定サイト数 | 1〜100棟 |
| サイト当たりデバイス数 | 5〜20台 |

---

## 2. 設計原則

| # | 原則 |
|---|------|
| 1 | 制御はローカル自律 |
| 2 | 通信断でも動作継続 |
| 3 | OSS・セルフホスト |
| 4 | セキュア（VPN） |

---

## 3. アーキテクチャ

### 3.1 プラットフォーム選定
**採用プラットフォーム: Home Assistant**

### 3.2 3層構成

| 層 | 構成要素 | 役割 |
|----|---------|------|
| デバイス層 | Pico 2 WH / W5500-PoE | センサー、アクチュエータ |
| ローカルGW層 | Raspberry Pi | 制御ロジック、DB |
| クラウド層 | VPS (optional) | 可視化、長期保存 |

---

## 4. ハードウェア構成

### センサー
| センサー | モデル | I/F | 数量 |
|----------|--------|-----|------|
| 温湿度 | SHT41 | I2C | 2 |
| CO2 | SCD41 | I2C | 1 |

### アクチュエータ
| アクチュエータ | ch | 電圧 |
|---------------|-----|------|
| 電磁弁 | 4ch | DC12V |
| サーキュレータ | 2ch | AC100V |

---

（以下省略）
```

---

## 7. 使用時の注意事項

### 7.1 カスタマイズ推奨箇所

| セクション | カスタマイズ内容 |
|-----------|-----------------|
| 設計原則 | プロジェクト固有の原則を追加 |
| ドメイン特有機能 | 業務要件に応じて詳細化 |
| 今後の課題 | 実際のプロジェクト計画を反映 |

### 7.2 テンプレート適用手順

1. 入力パラメータYAMLを作成
2. スキル実行でテンプレート生成
3. 生成された仕様書を確認
4. プロジェクト固有の内容を追記
5. レビュー・承認

---

## 8. 参考資料

- [SYSTEM_SPEC_v1.md](実例) - 農業IoTシステム仕様書
- [Home Assistant](https://www.home-assistant.io/)
- [MQTT仕様](https://mqtt.org/)
- [Node-RED](https://nodered.org/)

---

**作成日**: 2026-02-04
**作成者**: 足軽1号
**parent_cmd**: skill_approval
